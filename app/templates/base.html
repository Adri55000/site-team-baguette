<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Team Baguette{% endblock %}</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">
	{% block head %}{% endblock %}
</head>

<body class="{% if session.get('darkmode') %}dark-mode{% endif %}">

<header>
    <div class="left-zone">
        <h1><a href="{{ url_for('main.home') }}">Team Baguette</a></h1>
    </div>

	<nav class="navbar" aria-label="Navigation principale">
  <ul class="nav-links">

    <!-- Planning (existe déjà : restream.planning) -->
    <li>
      <a class="nav-link" href="{{ url_for('restream.planning') }}">{{ _("Planning") }}</a>
    </li>

    <!-- Tournois : on garde le dropdown (en cours / à venir),
         mais on ajoute "Tous les tournois" en placeholder pour l'instant -->
    <li class="nav-dropdown">
      <span class="nav-link">{{ _("Tournois") }} ▾</span>

      <ul class="dropdown-menu">
        {% if tournaments_active %}
          <li class="dropdown-title">{{ _("En cours") }}</li>
          {% for t in tournaments_active %}
            <li>
              <a href="{{ url_for('main.tournament', slug=t.slug) }}">
                {{ t.display_name or t.name }}
              </a>
            </li>
          {% endfor %}
        {% endif %}

        {% if tournaments_upcoming %}
          <li class="dropdown-title">{{ _("À venir") }}</li>
          {% for t in tournaments_upcoming %}
            <li>
              <a href="{{ url_for('main.tournament', slug=t.slug) }}">
                {{ t.display_name or t.name }}
              </a>
            </li>
          {% endfor %}
        {% endif %}

        <li class="dropdown-separator"></li>
        <li>
          <a href="{{ url_for('main.tournaments') }}">{{ _("Tous les tournois")}}</a>
        </li>
      </ul>
    </li>

    <!-- Restream : dropdown existant, mais structure HTML corrigée -->
    <li class="nav-dropdown">
      <span class="nav-link">{{ _("Restream")}} ▾</span>

      <ul class="dropdown-menu">
        <li class="dropdown-title">{{ _("Restream")}}</li>

        <li>
          <a href="{{ url_for('restream.planning') }}?filter=restream">{{ _("Planning des restream")}}</a>
        </li>

        {% if restreams %}
          <li class="dropdown-separator"></li>
          {% for r in restreams %}
            <li>
              <a href="{{ url_for('restream.view', slug=r['slug']) }}">
                {{ r['title'] }}
              </a>
            </li>
          {% endfor %}
        {% endif %}

        {% if has_role("restreamer") %}
          <li class="dropdown-separator"></li>
          <li>
            <a href="{{ url_for('restream.manage') }}">⚙ {{ _("Gérer les restreams")}}</a>
          </li>
        {% endif %}
      </ul>
    </li>

    <!-- Guides placeholder (pas de lien) -->
    <li>
      <span class="nav-link is-disabled">{{ _("Guides")}}</span>
    </li>

    <!-- Contact placeholder (pas de lien) -->
    <li>
      <a class="nav-link" href="{{ url_for('main.contact') }}">{{ _("Contact")}}</a>
    </li>

  </ul>
</nav>




<div class="right-zone">
{% if current_user.is_authenticated and current_user.role == "admin" %}
    <a href="{{ url_for('admin.dashboard') }}" class="btn admin-btn">{{ _("Admin")}}</a>
{% endif %}

    {% if current_user.is_authenticated %}
        <div class="user-info">
            <a href="{{ url_for('main.profile') }}" class="avatar-link">
                <img src="{{ url_for('static',
                    filename='avatars/' + (current_user.avatar or 'default.png')) }}"
                    class="avatar">
            </a>

            <span class="status">
                <b>{{ current_user.username }}</b>
            </span>

            <a href="{{ url_for('auth.logout') }}" class="btn">{{ _("Déconnexion")}}</a>
        </div>
    {% else %}
        <a href="{{ url_for('auth.login') }}" class="btn">{{ _("Connexion")}}</a>
        <a href="{{ url_for('auth.register') }}" class="btn">{{ _("S'inscrire")}}</a>
    {% endif %}

    <!-- Bouton thème -->
    <button id="theme-toggle" class="theme-btn">☀</button>
	
	<!-- Bouton langue -->
	<div class="lang-switch" data-lang>
	  <button type="button" class="lang-trigger" aria-haspopup="true" aria-expanded="false">
		<img
		  class="lang-flag-img"
		  src="{{ url_for('static', filename='icons/flags/' ~ current_lang ~ '.svg') }}"
		  alt=""
		  aria-hidden="true"
		>
		<span class="lang-code">{{ current_lang|upper }}</span>
	  </button>

	  <div class="lang-menu" role="menu">
		<a class="lang-item"
		   data-lang="fr"
		   href="{{ url_for('main.set_lang', lang='fr') }}"
		   aria-label="Français">
		  <img class="lang-flag-img" src="{{ url_for('static', filename='icons/flags/fr.svg') }}" alt="">
		</a>

		<a class="lang-item"
		   data-lang="en"
		   href="{{ url_for('main.set_lang', lang='en') }}"
		   aria-label="English">
		  <img class="lang-flag-img" src="{{ url_for('static', filename='icons/flags/en.svg') }}" alt="">
		</a>

	  </div>
	</div>
</div>


</header>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-container">
      {% for category, message in messages %}
        <div class="flash flash-{{ category }}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}
<!-- DEBUG LANG: {{ current_lang }} -->
<main>
    {% block content %}{% endblock %}
</main>

<script src="{{ url_for('static', filename='js/theme.js') }}"></script>
<script src="{{ url_for('static', filename='js/navbar.js') }}"></script>
<script src="{{ url_for('static', filename='js/lang.js') }}"></script>


{% block scripts %}{% endblock %}

</body>
</html>

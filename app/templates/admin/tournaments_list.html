{% extends "base.html" %}
{% block title %}{{ _("Gestion des tournois") }}{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/features/admin.css') }}">
{% endblock %}

{% set STATUS_LABELS = {
    "draft": {{ _("Brouillon") }},
    "active": {{ _("En cours") }},
    "finished": {{ _("Terminé") }}
} %}

{% block content %}
<div class="admin-dashboard">

<h1>{{ _("Gestion des tournois") }}</h1>

<!-- TOOLBAR -->
<div class="admin-card admin-user-toolbar">
    <form method="get" action="{{ url_for('admin.tournaments_list') }}">
        <input type="text"
               name="q"
               placeholder="{{ _('Rechercher un tournoi…') }}"
               value="{{ search or '' }}">

        <select name="status">
            <option value="">{{ _("Tous les statuts") }}</option>
            <option value="draft" {{ 'selected' if status == 'draft' }}>{{ _("Brouillon") }}</option>
            <option value="active" {{ 'selected' if status == 'active' }}>{{ _("En cours") }}</option>
            <option value="finished" {{ 'selected' if status == 'finished' }}>{{ _("Terminé") }}</option>
        </select>

        <button type="submit" class="btn">{{ _("Filtrer") }}</button>
    </form>

    <div class="admin-toolbar-actions">
        <a href="{{ url_for('admin.tournaments_create') }}"
           class="btn btn-primary">
            {{ _("Ajouter") }}
        </a>
    </div>
</div>

<!-- TABLE -->
<div class="admin-card">
    <table class="admin-table">
        <thead>
            <tr>
                <th class="col-name">{{ _("Nom") }}</th>
                <th>{{ _("Jeu") }}</th>
				<th>{{ _("Équipes") }}</th>
                <th>{{ _("Statut") }}</th>
                <th>{{ _("Source") }}</th>
                <th>{{ _("Créé le") }}</th>
                <th class="actions">{{ _("Actions") }}</th>
            </tr>
        </thead>
        <tbody>
        {% for t in tournaments %}
            <tr>
                <td class="col-name">{{ t.name }}</td>
                <td>{{ t.game_name or "—" }}</td>
				<td>
					{{ ngettext("%(count)s équipe","%(count)s équipes",t.team_count) | format(count=t.team_count) }}
				</td>
                <td>{{ STATUS_LABELS.get(t.status, t.status) }}</td>
                <td>{{ t.source }}</td>
                <td>{{ t.created_at[:16].replace("T", " ") }}</td>
                <td class="actions">
                    <a href="{{ url_for('admin.admin_tournament_edit', tournament_id=t.id) }}"
                       class="btn btn-secondary-small">
                        {{ _("Gérer les infos") }}
                    </a>

                    <a href="{{ url_for('admin.admin_tournament_teams', tournament_id=t.id) }}"
                       class="btn btn-secondary-small">
                        {{ _("Gérer les inscriptions") }}
                    </a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="6" class="empty">
                    {{ _("Aucun tournoi trouvé.") }}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- PAGINATION -->
{% if total_pages > 1 %}
<div class="admin-pagination">
    {% if page > 1 %}
        <a class="btn"
           href="{{ url_for('admin.tournaments_list',
                            page=page-1,
                            q=search,
                            status=status) }}">
            ← {{ _("Précédent") }}
        </a>
    {% else %}
        <span></span>
    {% endif %}

    <span class="admin-pagination-info">
        {{ _("Page") }} {{ page }} / {{ total_pages }}
    </span>

    {% if page < total_pages %}
        <a class="btn"
           href="{{ url_for('admin.tournaments_list',
                            page=page+1,
                            q=search,
                            status=status) }}">
            {{ _("Suivant") }} →
        </a>
    {% else %}
        <span></span>
    {% endif %}
</div>
{% endif %}

</div>
{% endblock %}

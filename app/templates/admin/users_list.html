{% extends "base.html" %}
{% block title %}{{ _("Gestion des utilisateurs") }}{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/features/admin.css') }}">

{% endblock %}

{% block content %}
<div class="admin-dashboard">

    <h1>{{ _("Gestion des utilisateurs") }}</h1>

    <!-- üîé Barre outils -->
    <div class="admin-card admin-user-toolbar">
        <form method="get" action="{{ url_for('admin.users_list') }}">
		<input type="text"
           name="q"
           placeholder="{{ _('Rechercher un utilisateur‚Ä¶') }}"
           value="{{ search or '' }}">

		<select name="role">
        <option value="">{{ _("Tous les r√¥les") }}</option>
        <option value="admin" {{ 'selected' if role=='admin' }}>{{ _("Admin") }}</option>
        <option value="restreamer" {{ 'selected' if role=='restreamer' }}>{{ _("Restreamer") }}</option>
        <option value="√©diteur" {{ 'selected' if role=='√©diteur' }}>{{ _("√âditeur") }}</option>
        <option value="invit√©" {{ 'selected' if role=='invit√©' }}>{{ _("Invit√©") }}</option>
		</select>

    <button class="btn">{{ _("Rechercher") }}</button>
</form>

    </div>

    <div class="admin-card">
	{% if search or role %}
	<p class="admin-filter-info">
    {{ _("Filtres actifs :") }}
    {% if search %} {{ _("recherche =") }} ‚Äú{{ search }}‚Äù {% endif %}
    {% if role %} {{ _("r√¥le =") }} {{ role }} {% endif %}
	</p>
	{% endif %}

        <table class="admin-table" id="userTable">
            <thead>
                <tr>
                    <th>{{ _("ID") }}</th>
                    <th>{{ _("Avatar") }}</th>
                    <th>{{ _("Pseudo") }}</th>
                    <th>{{ _("R√¥le") }}</th>
                    <th>{{ _("Statut") }}</th>
                    <th>{{ _("Actions") }}</th>
                </tr>
            </thead>

            <tbody>
			{% if users %}
            {% for u in users %}
                <tr data-username="{{ u.username|lower }}" data-role="{{ u.role|lower }}">
                    <td>{{ u.id }}</td>

                    <td>
                        <img src="{{ url_for('static', filename='avatars/' + (u.avatar_filename or 'default.png')) }}"
                             class="user-avatar-small">
                    </td>

                    <td>{{ u.username }}</td>

                    <td>
                        <span class="badge-role role-{{ u.role }}">{{ u.role }}</span>
                    </td>

                    <td>
                        {% if u.is_active %}
                            <span class="badge-active">{{ _("Actif") }}</span>
                        {% else %}
                            <span class="badge-inactive">{{ _("D√©sactiv√©") }}</span>
                        {% endif %}
                    </td>

                    <td>
                        <a href="{{ url_for('admin.edit_user', user_id=u.id) }}"
                           class="btn-secondary-small">{{ _("Modifier") }}</a>
                    </td>
                </tr>
            {% endfor %}
			{% else %}
				<tr>
				<td colspan="6" class="admin-empty">
				{{ _("Aucun utilisateur ne correspond aux filtres.") }}
				</td>
				</tr>
			{% endif %}
            </tbody>
        </table>
    </div>
{% if total_pages > 1 %}
<div class="admin-pagination">
    {% if page > 1 %}
        <a class="btn"
           href="{{ url_for('admin.users_list', page=page-1, q=search, role=role) }}">
            ‚Üê {{ _("Pr√©c√©dent") }}
        </a>
    {% else %}
        <span></span>
    {% endif %}

    <span class="admin-pagination-info">
        {{ _("Page") }} {{ page }} / {{ total_pages }}
    </span>

    {% if page < total_pages %}
        <a class="btn"
           href="{{ url_for('admin.users_list', page=page+1, q=search, role=role) }}">
            {{ _("Suivant") }} ‚Üí
        </a>
    {% else %}
        <span></span>
    {% endif %}
</div>
{% endif %}



</div>


{% endblock %}

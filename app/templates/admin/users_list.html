{% extends "base.html" %}
{% block title %}Gestion des utilisateurs{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/features/admin.css') }}">

{% endblock %}

{% block content %}
<div class="admin-dashboard">

    <h1>Gestion des utilisateurs</h1>

    <!-- üîé Barre outils -->
    <div class="admin-card admin-user-toolbar">
        <form method="get" action="{{ url_for('admin.users_list') }}">
		<input type="text"
           name="q"
           placeholder="Rechercher un utilisateur‚Ä¶"
           value="{{ search or '' }}">

		<select name="role">
        <option value="">Tous les r√¥les</option>
        <option value="admin" {{ 'selected' if role=='admin' }}>Admin</option>
        <option value="restreamer" {{ 'selected' if role=='restreamer' }}>Restreamer</option>
        <option value="√©diteur" {{ 'selected' if role=='√©diteur' }}>√âditeur</option>
        <option value="invit√©" {{ 'selected' if role=='invit√©' }}>Invit√©</option>
		</select>

    <button class="btn">Rechercher</button>
</form>

    </div>

    <div class="admin-card">
	{% if search or role %}
	<p class="admin-filter-info">
    Filtres actifs :
    {% if search %} recherche = ‚Äú{{ search }}‚Äù {% endif %}
    {% if role %} r√¥le = {{ role }} {% endif %}
	</p>
	{% endif %}

        <table class="admin-table" id="userTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Avatar</th>
                    <th>Pseudo</th>
                    <th>R√¥le</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>

            <tbody>
			{% if users %}
            {% for u in users %}
                <tr data-username="{{ u.username|lower }}" data-role="{{ u.role|lower }}">
                    <td>{{ u.id }}</td>

                    <td>
                        <img src="{{ url_for('static', filename='avatars/' + (u.avatar_filename or 'default.png')) }}"
                             class="user-avatar-small">
                    </td>

                    <td>{{ u.username }}</td>

                    <td>
                        <span class="badge-role role-{{ u.role }}">{{ u.role }}</span>
                    </td>

                    <td>
                        {% if u.is_active %}
                            <span class="badge-active">Actif</span>
                        {% else %}
                            <span class="badge-inactive">D√©sactiv√©</span>
                        {% endif %}
                    </td>

                    <td>
                        <a href="{{ url_for('admin.edit_user', user_id=u.id) }}"
                           class="btn-secondary-small">Modifier</a>
                    </td>
                </tr>
            {% endfor %}
			{% else %}
				<tr>
				<td colspan="6" class="admin-empty">
				Aucun utilisateur ne correspond aux filtres.
				</td>
				</tr>
			{% endif %}
            </tbody>
        </table>
    </div>
{% if total_pages > 1 %}
<div class="admin-pagination">
    {% if page > 1 %}
        <a class="btn"
           href="{{ url_for('admin.users_list', page=page-1, q=search, role=role) }}">
            ‚Üê Pr√©c√©dent
        </a>
    {% else %}
        <span></span>
    {% endif %}

    <span class="admin-pagination-info">
        Page {{ page }} / {{ total_pages }}
    </span>

    {% if page < total_pages %}
        <a class="btn"
           href="{{ url_for('admin.users_list', page=page+1, q=search, role=role) }}">
            Suivant ‚Üí
        </a>
    {% else %}
        <span></span>
    {% endif %}
</div>
{% endif %}



</div>


{% endblock %}

{% extends "base.html" %}
{% block title %}Matchs de la confrontation{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/features/admin.css') }}">
{% endblock %}

{% block content %}
<div class="admin-dashboard">

<h1>Matchs de la confrontation</h1>
<div class="admin-card">
<p class="admin-subtitle">
    {{ (series.team1_name or "À déterminer") | team_name }} vs {{ (series.team2_name or "À déterminer") | team_name }}
    {% if series.stage %} — {{ series.stage }}{% endif %}
</p>

<p class="text-muted">
    Phase : <strong>{{ series.phase_name }}</strong>
</p>


{% set wins = (series.team1_wins or 0) + (series.team2_wins or 0) %}

{% if series.team1_id and series.team2_id %}
<p class="text-muted">
    BO{{ series.best_of }} — {{ series.team1_wins or 0 }} – {{ series.team2_wins or 0 }}
</p>

<p class="text-muted">
    {{ wins }} victoire{{ 's' if wins != 1 }} sur {{ series.best_of }}
</p>
{% else %}
<p class="text-muted">
    BO{{ series.best_of }} — confrontation prévisionnelle (équipes à définir)
</p>
{% endif %}

{% if series.winner_team_id %}
    <p>
        <span class="badge badge-success">Confrontation gagnée</span>
    </p>
{% elif matches %}
    <p>
        <span class="badge badge-warning">Confrontation en cours</span>
    </p>
{% else %}
    <p>
        {% if not series.team1_id or not series.team2_id %}
            <span class="badge badge-muted">Confrontation prévisionnelle</span>
        {% else %}
            <span class="badge badge-muted">Aucun match</span>
        {% endif %}
    </p>
{% endif %}


{% if series.winner_team_id %}
<p class="text-muted">
    Cette confrontation est gagnée.  
    Les résultats peuvent toujours être modifiés en cas de correction ou disqualification.
</p>
{% endif %}
</div>
{% if series.tournament_status != "finished" %}
<div class="admin-actions-toolbar">
    {% if not series.winner_team_id %}
    <a class="btn btn-primary"
       href="{{ url_for('admin.admin_match_create', series_id=series.id) }}">
        Ajouter un match
    </a>
    {% endif %}
</div>
{% endif %}

<div class="admin-card">
<table class="admin-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Date</th>
            <th>Statut</th>
            <th class="actions">Actions</th>
        </tr>
    </thead>
    <tbody>
    {% if matches %}
        {% for m in matches %}
        <tr>
            <td>#{{ m.id }}</td>
            <td>
                {{ m.scheduled_at[:16].replace("T", " ") if m.scheduled_at else "—" }}
            </td>
            <td>
                {% if m.is_completed %}
                    <span class="badge badge-success">Terminé</span>
                {% else %}
                    <span class="badge badge-muted">À jouer</span>
                {% endif %}
            </td>
            <td class="actions">
                <a class="btn btn-primary-small"
                   href="{{ url_for('admin.admin_match_results', match_id=m.id) }}">
                    Saisir les résultats
                </a>
                <a class="btn btn-secondary-small"
                   href="{{ url_for('admin.admin_match_edit', match_id=m.id) }}">
                    Modifier
                </a>
                {% if series.tournament_status != "finished" and not m.is_completed %}
                <form method="post"
                      action="{{ url_for('admin.admin_match_delete', match_id=m.id) }}"
                      class="inline-form">
                    <button class="btn btn-danger-small"
                            onclick="return confirm('Supprimer ce match ?')">
                        Supprimer
                    </button>
                </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    {% else %}
        <tr>
            <td colspan="4" class="admin-empty">
                Aucun match pour cette confrontation.
            </td>
        </tr>
    {% endif %}
    </tbody>
</table>
</div>

<div class="admin-actions-footer">
    <a class="btn btn-secondary"
       href="{{ url_for('admin.admin_matches',
                        tournament_id=series.tournament_id) }}">
        ← Retour aux confrontations
    </a>
</div>

</div>
{% endblock %}

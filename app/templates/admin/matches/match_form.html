{% extends "base.html" %}
{% block title %}{{ _("Match") }}{% endblock %}
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/features/admin.css') }}">
{% endblock %}

{% block content %}
<div class="admin-dashboard">

<h1>{{ _("Créer un match") }}</h1>

<form method="post" class="admin-card admin-form">

    {% if series %}
        <input type="hidden" name="series_id" value="{{ series.id }}">
        <p class="admin-subtitle">
            {{ _("Confrontation :") }} {{ series['team1_name'] | team_name  }} vs {{ series['team2_name'] | team_name  }}
        </p>
    {% else %}
        <p class="admin-subtitle">
            {{ _("Tie-break — sélection des équipes") }}
        </p>

        <label>{{ _("Équipes participantes") }}</label>

<input type="text"
       placeholder="{{ _('Rechercher une équipe…') }}"
       class="admin-search"
       onkeyup="filterTeams(this.value)">

<div class="admin-checkbox-list" id="team-list">
    {% for t in teams %}
        <label data-name="{{ t['name'] | lower }}">
            <input type="checkbox" name="team_ids" value="{{ t['id'] }}">
            {{ t['name'] | team_name }}
        </label>
    {% endfor %}
</div>

    {% endif %}

    <input type="hidden" name="tournament_id" value="{{ tournament.id }}">

    <label>{{ _("Date / heure prévue") }}</label>
    <input type="datetime-local"
       name="scheduled_at"
       value="{{ match.scheduled_at[:16] if match and match.scheduled_at else '' }}">

	<label for="racetime_room">{{ _("Racetime room") }}</label>
	<input type="text"
		   id="racetime_room"
		   name="racetime_room"
		   class="admin-input"
		   value="{{ match.racetime_room if match and match.racetime_room else '' }}"
		   placeholder="https://racetime.gg/lozssr/abcdef">

	<p class="admin-help">
		{{ _("URL de la room racetime (optionnel).") }}
	</p>

	{% if match and match.racetime_room %}
	<p>
		<a href="{{ match.racetime_room }}" target="_blank" class="btn btn-secondary-small">
			{{ _("Ouvrir la room racetime") }}
		</a>
	</p>
	{% endif %}


    <div class="admin-actions-footer">
        <button class="btn btn-primary">
            {{ _("Enregistrer") }}
        </button>

        <a href="{{ url_for('admin.admin_matches',
                             tournament_id=tournament.id) }}"
           class="btn btn-secondary">
            {{ _("Annuler") }}
        </a>
    </div>

</form>

</div>

<script>
function filterTeams(query) {
    query = query.toLowerCase();
    document.querySelectorAll('#team-list label').forEach(label => {
        label.style.display =
            label.dataset.name.includes(query) ? '' : 'none';
    });
}
</script>

{% endblock %}
